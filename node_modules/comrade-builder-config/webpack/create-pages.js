const path = require('path')
const glob = require('glob')

const HtmlWebpackPlugin = require('html-webpack-plugin')

const createPage = (env, base) => {
  return new HtmlWebpackPlugin({
    filename: './' + base + '.html',
    template: `./src/pages/${base}.pug`,
    chunks: ['runtime', 'core'],
    inject: false,
    pretty: true,
    templateParameters: (compilation, assets) => {
      return {
        ASSETS: assets,
        APP_MODE: env
      }
    }
  })
}

module.exports = function (env, __base, activePages) {
  console.log(activePages)
  let result = []
  let pages = glob.sync(path.resolve(__base, './src/pages/*.pug'))
  pages.forEach(function (file) {
    let base = path.basename(file, '.pug')
    if (activePages && activePages.length > 0 && env !== 'production') {
      if (activePages.includes(base)) {
        result.push(createPage(env, base))
      }
    } else {
      result.push(createPage(env, base))
    }
  })
  return result
}
